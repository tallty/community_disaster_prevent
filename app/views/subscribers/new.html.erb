<div id="map_container1"></div>
<div class="subscribers-container">
  <div class="row">
    <div class="col-xs-12">
      <!-- <h3>上海市社区气象安全一点通</h3> -->
    </div>
    <div class="col-xs-12">
      <div class="row">
        <div class="col-xs-12">
          <p class="subscribers-hello">Hello, <%= @subscriber.nick_name %></p>
        </div>
        <div class="col-xs-12 logic-btn">
          <a href="javascript:;" class="weui_btn weui_btn_mini weui_btn_plain_primary btn-block" id= "head_List" style="text-decoration: none;">手动选择社区</a>
          <%= link_to "加入志愿者队伍", "#", class: "weui_btn weui_btn_mini weui_btn_plain_primary btn-block" %>
        </div>
      </div>
      
      <div class="communities_change1">
        <i class="iconfont" style="color: #F5A623;">&#xe607;</i>
        您当前定位社区为：
        <span id="location_address">
          <% if @community %>
            <%= "#{@community["District_Name"]}#{@community["Name"]}" %>
          <% else %>
            <button class="btn btn-xs btn-info" onclick="window.location.reload();">重新定位</button>
          <% end %>
        </span>
      </div>

    </div>
    <div class="col-xs-12">
      <% if @subscriber.community.present? %>
        <%= link_to "加入志愿者队伍", "/volunteers/new?openid=#{@subscriber.openid}" %>
      <% end %>
    </div>
    <div class="col-xs-12 notice">
      <%= notice %>
    </div>
    <div class="col-xs-12">
      <%= form_for @subscriber,  :url => { :action => :update } do |f| %>
        <div class="form-inputs" style="display: none;">
          <div class="input-group col-xs-12">
            <%= f.hidden_field :openid, value: @subscriber.openid %>
          </div>
          <div class="space-6"></div>

          <% if @subscriber.community.present? %>
            <div class="input-group col-xs-12">
            <%= f.select :district, options_for_select(Community.where("district <> '上海'").distinct.pluck(:district), @subscriber.community.district), options = {:prompt =>"请选择绑定区县" }, :class =>"form-control input" %>
            </div>
            <div class="space-6"></div>
            <div class="input-group col-xs-12">
              <%= f.select :community, options_for_select(Community.where("district = ?", @subscriber.community.district).pluck(:street), @subscriber.community.street), options ={:prompt =>"请选择绑定街道"}, :class =>"form-control input" %>
            </div>
          <% else %>
            <div class="input-group col-xs-12">
            <%= f.select :district, Community.where("district <> '上海'").distinct.pluck(:district), options = {:prompt =>"请选择绑定区县" }, :class =>"form-control input" %>
            </div>
            <div class="space-6"></div>
            <div class="input-group col-xs-12">
              <%= f.select :community, [], options ={:prompt =>"请选择绑定街道"}, :class =>"form-control input" %>
            </div>
          <% end %>
            <div class="space-6"></div>
        </div>
          <%= f.submit "绑定", :class => "btn bind-btn btn-success" %>
          
      <% end %>
    </div>
  </div>
  <div style="height: 50px;"></div>
</div>

<%= content_for :scripts do %>
  <%= javascript_tag do %>
    get_streets_path = "<%= get_streets_subscribers_path %>"
  <% end %>
  <%= javascript_include_tag "weixin_comm", 'data-turbolinks-track' => true  %>
<% end %>

<%= render partial: "weixin_share/mapbar_container", locals: { lon: params[:lon], lat: params[:lat] } %>

<script type="text/javascript">
  $("#head_List").on("click", function(){
    if($(".form-inputs").css("display")=="none"){
      $(".form-inputs").slideDown(800);
    }else{
      $(".form-inputs").slideUp(800);
    }
  });
</script>
